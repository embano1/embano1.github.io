<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="When Twitter Likes become your Bookmarks"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@embano1"/>



  	<meta property="og:title" content="When Twitter Likes become your Bookmarks &middot; Do not go gentle into this good night. Rage." />
  	<meta property="og:site_name" content="Do not go gentle into this good night. Rage." />
  	<meta property="og:url" content="https://embano1.github.io/post/tw/" />

    
        
            <meta property="og:image" content="/none.jpg"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2018-07-05T21:10:15&#43;02:00" />

    
    <meta property="article:tag" content="Twitter" />
    
    <meta property="article:tag" content="JSON" />
    
    

    <title>When Twitter Likes become your Bookmarks &middot; Do not go gentle into this good night. Rage.</title>

    
    <meta name="description" content="I confess, I&amp;rsquo;ve been (mis)using Twitter&amp;rsquo;s famous Like button since joining this great platform. Thus, if you look at my Twitter Likes you&amp;rsquo;ll m" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://embano1.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://embano1.github.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://embano1.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://embano1.github.io/css/nav.css" />

    

    
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/ocean.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
    

    
      
          <link href="https://embano1.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Do not go gentle into this good night. Rage." />
      
      
    
    <meta name="generator" content="Hugo 0.42.2" />

    <link rel="canonical" href="https://embano1.github.io/post/tw/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ,
        "logo": https://embano1.github.io/images/gopher.jpg
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "image": {
            "@type": "ImageObject",
            "url": https://embano1.github.io/images/gopher.jpg,
            "width": 250,
            "height": 250
        }, 
        
        "url": ,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": When Twitter Likes become your Bookmarks,
    "name": When Twitter Likes become your Bookmarks,
    "wordCount": 1594,
    "timeRequired": "PT8M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": https://embano1.github.io/post/tw/,
    "datePublished": 2018-07-05T21:10Z,
    "dateModified": 2018-07-05T21:10Z,
    
    "keywords": Twitter, JSON,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://embano1.github.io/post/tw/
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-108156810-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://embano1.github.io/about">About me</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://embano1.github.io/post">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://embano1.github.io/tags">Tags</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="https://embano1.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="https://embano1.github.io/"><img src="https://embano1.github.io/images/gopher.jpg" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">When Twitter Likes become your Bookmarks</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2018-07-05T21:10:15&#43;02:00">
            Jul 5, 2018
          </time>
        
         
          <span class="post-tag small"><a href="https://embano1.github.io//tags/twitter/">#Twitter</a></span>
         
          <span class="post-tag small"><a href="https://embano1.github.io//tags/json/">#JSON</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p><img src="https://cdn.vox-cdn.com/thumbor/kA-ikIyInItp2OuWG_dd1PfrFo4=/0x16:2200x1483/1820x1213/filters:focal(0x16:2200x1483):format(webp)/cdn.vox-cdn.com/uploads/chorus_image/image/47574011/twitter-hearts-and-stars.0.0.png" width="80" title="Source: The Verge"></img></p>

<p>I confess, I&rsquo;ve been (mis)using Twitter&rsquo;s famous <em>Like</em> button since joining this great platform. Thus, if you look at my <a href="https://twitter.com/embano1/likes" target="_blank">Twitter Likes</a> you&rsquo;ll mainly find tweets about distributed systems, Go and Kubernetes.</p>

<p>Yes, I know it&rsquo;s wrong! But looks like I am <a href="https://twitter.com/mkaptano/status/948588218009649152" target="_blank">not</a> the <a href="https://twitter.com/JamesMunnelly/status/1014982229989183493" target="_blank">only one</a> going down this dark path :) Unfortunately, if you have hundreds or thousands of bookmarks, ehm <em>Likes</em>, finding the one you desperately need is almost impossible due to the way the twitter.com UI is designed.</p>

<p>I am not using any native Twitter client on OSX. In case your favorite client (Tweetbot?) already provides that functionality for you, including regular expression support and querying advanced Twitter API fields, nice! You might want to stop reading here. But in case you&rsquo;re interested in a way to do that programmatically on the command line (CLI) of your operating system of choice with full flexibility and JSON support, read on. You might also learn some neat JSON filters along the way :)</p>

<p>Typically, I need to perform these actions when searching through my Twitter &ldquo;bookmarks&rdquo;:</p>

<ul>
<li>Filter tweets for a <strong>specific string</strong>, e.g. <code>&quot;Kubernetes&quot;</code></li>
<li>Look for tweets <strong>containing &ldquo;A&rdquo; and &ldquo;B&rdquo;</strong>; order and capitals should not matter, e.g. <code>&quot;...best practices...Golang&quot;</code> or <code>&quot;Go...Best Practices&quot;</code></li>
<li>Filter tweets containing <strong>only Youtube videos</strong> of a specific topic or from a specific user; this requires access to some extended Twitter API fields because links in tweets are typically shortened to <code>https://t.co/...</code></li>
</ul>

<p>This and much more can be done with the powerful combination of two CLI tools: <code>tw</code> and <code>jq</code>.</p>

<p><a href="https://github.com/embano1/tw" target="_blank">tw</a> is a tool I created to easily access the Twitter API from your CLI. At the time of writing this post, only <em>Likes</em> are supported. <a href="https://stedolan.github.io/jq/" target="_blank">jq</a> is a <em>lightweight and flexible command-line JSON processor</em>.</p>

<p>Of course, you can also use <code>grep</code> or similar tools to just filter for a specific string. <code>tw</code> has a <code>--pretty</code> option which generates a compact summary of your Twitter <em>Likes</em> (Author, Text, Link) which makes filtering with <code>grep</code> easy. For advanced queries, <code>tw</code>&rsquo;s JSON output from the Twitter API and a processor like <code>jq</code> is the way to go. Scott S. Lowe provides some alternatives to <code>jq</code> in <a href="https://blog.scottlowe.org/2018/06/28/more-handy-cli-tools-json/" target="_blank">this post</a>.</p>

<h2 id="getting-the-tools">Getting the tools</h2>

<p><code>tw</code> is a statically compiled Go binary which you can easily install on Windows, Linux and OSX. You can either grab a <a href="https://github.com/embano1/tw/releases" target="_blank">release</a>, use <em>Homebrew</em> to install it on OSX, use Docker or build from source (see <a href="https://github.com/embano1/tw#get-it" target="_blank">README</a> in the Github repository).</p>

<p>With Homebrew: <code>brew install embano1/tw/tw</code><br />
With Docker: <code>docker pull embano1/tw</code></p>

<p>The Docker image contains <code>jq</code>. If you don&rsquo;t want to use the Docker image, please install <code>jq</code> as well to follow along with the examples. You can grab a release <a href="https://stedolan.github.io/jq/" target="_blank">here</a> or, e.g. for OSX, install via Homebrew: <code>brew install jq</code></p>

<h2 id="accessing-the-twitter-api">Accessing the Twitter API</h2>

<p>In order to use Twitter&rsquo;s API one has to authenticate. This is to protect the Twitter service.</p>

<blockquote>
<p>Twitter uses OAuth to provide authorized access to its API.</p>
</blockquote>

<p>As such, <code>tw</code> needs credentials before it can make requests against the Twitter API. A step-by-step guide is provided in the <a href="https://github.com/embano1/tw#authentication" target="_blank">README section</a>. Please make sure to set this up before proceeding.</p>

<p>(Waiting&hellip;)</p>

<p>Ok, welcome back! Let&rsquo;s show the power of both tools in action.</p>

<h2 id="examples">Examples</h2>

<p>We&rsquo;ll use the Docker image for our examples. The examples assume that you stored your Twitter API credentials in the file <code>~/auth.json</code>.</p>

<p>Let&rsquo;s test if everything is working.</p>

<pre><code class="language-bash"># Start interactive session and shell
$ docker run -it -v ~/auth.json:/auth.json embano1/tw sh

# Query your likes using pretty printing (-p) 
/ tw -f auth.json likes -p
(...)
-----------------------
From: golangweekly
Text: &quot;How I Structure Production Grade REST APIs in Go: https://t.co/UGf25MuV9P (The initial post in the series, it focuses on application structure and routing.)&quot;
Link: https://medium.com/@tonyalaribe/structuring-a-production-grade-rest-api-in-golang-c0229b3feedc
-----------------------
(...)
</code></pre>

<p>Thumbs up!</p>

<p>If <code>tw</code> complains about missing/incorrect credentials, make sure you correctly followed the section &ldquo;Accessing the Twitter API&rdquo; in this post. Depending on the number of <em>Likes</em> it might take a while to query the API.</p>

<p><strong>Note:</strong> The Twitter API uses rate limiting to protect against (D)DoS attacks. To prevent throttling or timeouts, I recommend dumping your Tweets into a file first and use that for filtering. It&rsquo;s also much faster, especially when querying thousands of <em>Likes</em>.</p>

<p>Let&rsquo;s move on with some concrete examples I use every day. We continue to use our Docker container session which started for our test above.</p>

<h3 id="1-only-print-tweets-containing-string-ignore-case">#1 Only print Tweets containing &ldquo;String&rdquo; (ignore case)</h3>

<p>First, dump all Tweets into a file.</p>

<pre><code class="language-bash">/ tw -f auth.json likes &gt; tweets.json
</code></pre>

<p>Since we want to do a <em>case-insensitive search</em>, we cannot use the <code>contains</code> function in <code>jq</code>. Fortunately, <code>jq</code> supports regular expressions, <em>regex</em> for short, with the <code>match</code> function.</p>

<pre><code class="language-bash">/ jq '.[]|select(.full_text|match(&quot;handy&quot;;&quot;i&quot;))|.full_text' tweets.json
(...)
&quot;[New Post] More Handy CLI Tools for JSON: https://t.co/CxAWaJbfI5&quot;
&quot;\&quot;Choosing an HTTP Status Code\&quot;\n\nA handy flowchart for figuring out which one applies in your situation.\n\n(Sadly no paths lead to 418...  )\n\nhttps://t.co/utMDLotwJx&quot;
(...)
</code></pre>

<p>Breaking down this command:</p>

<ul>
<li><code>.[]</code> # query all array members in the JSON file</li>
<li><code>|</code> # pipe the left object(s) to the next command, in our case the whole array</li>
<li><code>select(.full_text|match</code> # use object field <code>full_text</code> and pipe it to the regex filter (<code>match</code>)</li>
<li><code>match(&quot;handy&quot;;&quot;i&quot;)</code> # filter for the string <code>&quot;handy&quot;</code> (would also match the word &ldquo;unhandy&rdquo; for example), ignore case with <code>;&quot;i&quot;</code></li>
<li><code>|.full_text</code> # pipe the result to next command; if there is a match, only output the <code>full_text</code> field</li>
</ul>

<p>If you want to search for the exact word, e.g. excluding &ldquo;unhandy&rdquo; from results:</p>

<pre><code class="language-bash">/ jq '.[]|select(.full_text|match(&quot;\\b(handy)\\b&quot;;&quot;i&quot;))|.full_text' tweets.json
</code></pre>

<h3 id="2-only-find-tweets-with-these-two-words-ignore-case-and-order">#2 Only find Tweets with these &ldquo;two&rdquo; &ldquo;Words&rdquo; (ignore case and order)</h3>

<p>Sometimes you want to search for two (or more) words, but don&rsquo;t know the order. For example, I typically search for &ldquo;best practices&rdquo; in combination with a technology, e.g. &ldquo;Docker&rdquo; or &ldquo;Kubernetes&rdquo;. Regular expressions with <em>lookahead</em> conditions are what we need here.</p>

<p>Let&rsquo;s filter for &ldquo;Go&rdquo; respectively &ldquo;Golang&rdquo; related tweets also mentioning &ldquo;production&rdquo;, &ldquo;practice&rdquo; or &ldquo;idiomatic&rdquo;. Again, this regex would also match &ldquo;practices&rdquo; since we don&rsquo;t ask for exact word matching here (not using <code>\b</code> word boundary checker in regex).</p>

<pre><code class="language-bash">$ jq '.[]| select( .full_text | match(&quot;(?=.*(\\bGo\\b|golang))(?=.*(production|practice|idiomatic))&quot;;&quot;i&quot;))|.text' tweets.json
(...)
&quot;How I Structure Production Grade REST APIs in Go: https://t.co/UGf25MuV9P (The initial post in the series, it focuses on application structure and routing.)&quot;
&quot;Building Scalable Web Services in Go: https://t.co/2Ul9ibqopd (A few best practices aggregated from around the world of Go.)&quot;
&quot;List of articles discussing \&quot;Idiomatic Go\&quot;\n\nhttps://t.co/LWUvxxmTCc\n\n#golang&quot;
(...)
</code></pre>

<p>Breaking down this command:</p>

<ul>
<li><code>.[]| select( .full_text |</code> # we want to apply our filter to <code>full_text</code> entries from our tweets</li>
<li><code>match()</code> # we want regex</li>
<li><code>&quot;(?=.*(\\bGo\\b|golang))(?=.*(production|practic|idiomatic))&quot;</code> # <em>lookahead</em> syntax for regex; simply speaking order of our two filters (something <code>Go OR Golang</code> and <code>production OR practice OR idiomatic</code>) does not matter</li>
<li>Note that the <code>|</code> in regex queries means <em>logic OR</em> and <strong>not</strong> pipe to next filter</li>
<li><code>;&quot;i&quot;))|.text</code> # case-insensive regex; if there is a match, only print tweet <code>text</code></li>
</ul>

<h3 id="3-only-print-field-s-we-re-interested-in">#3 Only print &ldquo;Field(s)&rdquo; we&rsquo;re interested in</h3>

<p>Sometimes all you want is a simple Tweet representation, e.g. by <em>User</em> (incl. full name), <em>Tweet</em> and <em>Link(s)</em>, if any. If <code>tw</code>&rsquo;s <code>--pretty</code> option is not enough, using <code>jq</code> arrays and maps is the right approach. It also keeps the JSON format, so you can do further filtering on the array/map.</p>

<pre><code class="language-bash">/ jq '[.[]|{user: .user.screen_name,name: .user.name, text: .full_text, url: [.entities.urls[].expanded_url]}]' tweets.json
(...)
[
  {
    &quot;user&quot;: &quot;timoreimann&quot;,
    &quot;name&quot;: &quot;Timo Reimann&quot;,
    &quot;text&quot;: &quot;@the_sttts @TheNikhita https://t.co/XVdwwzJxXX is comprehensive, though it might be a bit overwhelming depending on how much you know already.\n\nGoogle's style guide does a good job to explain bash behav
ior: https://t.co/z4sfr0oiKj\n\nFinally, enabling shellcheck is a great way to learn while scripting.&quot;,
    &quot;url&quot;: [
      &quot;https://mywiki.wooledge.org/BashFAQ&quot;,
      &quot;https://google.github.io/styleguide/shell.xml&quot;
    ]
  },
  {
    &quot;user&quot;: &quot;vCabbage&quot;,
    &quot;name&quot;: &quot;Kale Blankenship&quot;,
    &quot;text&quot;: &quot;@copyconstruct https://t.co/lziacf4S4q works pretty well for this.&quot;,
    &quot;url&quot;: [
      &quot;https://github.com/fortytw2/leaktest&quot;
    ]
  },
(...)
</code></pre>

<p>Breaking down this command:</p>

<ul>
<li>Outermost <code>[...]</code> # create one resulting array for the output of the map/filter specified</li>
<li><code>.[]|{user: .user.screen_name,...</code> # for each input object create a new map mapping the specified input fields to custom ones (left side of <code>:</code>)</li>
<li><code>url: [.entities.urls[].expanded_url]}</code> # <code>.urls[]</code> could be empty, one or multiple, thus creating an array (with <code>[]</code>) for the mapped entry <code>url:</code></li>
</ul>

<h3 id="4-filter-for-tweets-with-links-to-youtube-videos">#4 Filter for Tweets with Links to Youtube videos</h3>

<p>There&rsquo;s always an amazing Go or distributed systems talk which I bookmark to watch later, e.g. on these long flights to the US. Filtering for Youtube tweets is not that easy without JSON because Twitter shortens links (<code>t.co...</code>).</p>

<p>Therefore we need to access an extended JSON field from our tweets (<code>.entities.urls[].expanded_url</code>).</p>

<pre><code class="language-bash">$ jq '[.[]|select( .entities.urls[].expanded_url | contains (&quot;youtube&quot;))|{text: .full_text, url: [.entities.urls[].expanded_url]}]' tweets.json
(...)
  {
    &quot;text&quot;: &quot;\&quot;Google Production Environment\&quot;\n\nAn intro to the infra that allows running processes reliably and scalably in data centers, as well as the development and build infrastructure that enables engineers to develop, deploy, and run large-scale services.\n\nhttps://t.co/W8nkNJlfPM&quot;,
    &quot;url&quot;: [
      &quot;https://www.youtube.com/watch?v=dhTVVWzpc4Q&quot;
    ]
  },
  {
    &quot;text&quot;: &quot;And my talk from yesterday about @kubernetes as an API driven platform â€“ API concepts, CRDs and controllers â€“ from our ReykjavÃ­k Kubernetes Meetup ðŸ‡®ðŸ‡¸Â https://t.co/cLg5EFDDPD&quot;,
    &quot;url&quot;: [
      &quot;https://www.youtube.com/watch?v=BiE7oKeEzDU&quot;
    ]
  },
(...)
</code></pre>

<p>We filter whether <code>.entities.urls[].expanded_url</code> contains the string <code>youtube</code> (case-sensitive, thus <code>contains</code> function works here) and pipe that into a map only containing the tweet text and url(s). The outermost brackets will create an array for us. So we could for example only print the first three items with a final filter: <code>|.[:3]</code> before closing the <code>jq</code> filter/query with <code>'</code>.</p>

<p>I hope you enjoyed this post. Yes, <code>jq</code> filters can be complex and hard to use, especially when not using them on a daily basis. For that reason, I maintain a Gist of filters I use regularly for <code>tw</code> <a href="https://gist.github.com/embano1/1631a6d44eaa7a934807ec80c7cc74e0" target="_blank">here</a>.</p>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="https://embano1.github.io/" style="background-image: url(/images/gopher.jpg)"><span class="hidden">Michael Gasch's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="https://embano1.github.io/">Michael Gasch</a></h4>
  
  <p>Read <a href="https://embano1.github.io/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Germany</span>
    
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=When%20Twitter%20Likes%20become%20your%20Bookmarks&amp;url=https%3a%2f%2fembano1.github.io%2fpost%2ftw%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fembano1.github.io%2fpost%2ftw%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fembano1.github.io%2fpost%2ftw%2f&amp;description=When%20Twitter%20Likes%20become%20your%20Bookmarks"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fembano1.github.io%2fpost%2ftw%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
  
      <a class="read-next-story prev" style="no-cover" href="https://embano1.github.io/post/podnodesel/">
          <section class="post">
              <h2>Understanding and using the Kubernetes PodNodeSelector Admission Controller</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Do not go gentle into this good night. Rage.</a> All rights reserved - 2018</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://embano1.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://embano1.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://embano1.github.io/js/index.js"></script>
    
</body>
</html>

